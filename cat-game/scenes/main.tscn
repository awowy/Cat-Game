[gd_scene load_steps=26 format=3 uid="uid://b1g2emsj6dnqc"]

[ext_resource type="Script" uid="uid://bp5kwpmn3qrt5" path="res://scripts/main.gd" id="1_jbj1t"]
[ext_resource type="Texture2D" uid="uid://byxnhtip5eemc" path="res://assets/pengumpulan assets gng-20251122T123235Z-1-001/pengumpulan assets gng/Background/Untitled56_20251122125549.png" id="1_jkv2x"]
[ext_resource type="PackedScene" uid="uid://m6vufvgd1ucs" path="res://scenes/player.tscn" id="1_sugp2"]
[ext_resource type="PackedScene" uid="uid://coaf5p7klldq2" path="res://scenes/camera_2d.tscn" id="2_jyhfs"]
[ext_resource type="PackedScene" uid="uid://84y145u6urx2" path="res://scenes/placeholder_ground.tscn" id="3_tbgi4"]
[ext_resource type="Script" uid="uid://ylvle5wwvksp" path="res://scripts/camera.gd" id="5_eb6dy"]
[ext_resource type="PackedScene" uid="uid://cj5qto4fg2mwq" path="res://scenes/insects.tscn" id="6_tefeu"]
[ext_resource type="Script" uid="uid://dj8ocu35gc2ar" path="res://scripts/killzone.gd" id="6_trceg"]
[ext_resource type="Script" path="res://scenes/window.gd" id="7_jbj1t"]
[ext_resource type="PackedScene" uid="uid://bbykibi67y2wq" path="res://scenes/insects_ui.tscn" id="7_o6xl0"]
[ext_resource type="PackedScene" uid="uid://g38sm6kqv7ku" path="res://scenes/platform_1.tscn" id="8_choun"]
[ext_resource type="PackedScene" uid="uid://qksx7wjcnp2f" path="res://scenes/platform_2.tscn" id="9_a8y0u"]
[ext_resource type="PackedScene" uid="uid://c8354cnyyojvk" path="res://scenes/platform_3.tscn" id="10_jkv2x"]
[ext_resource type="PackedScene" uid="uid://dr03xxs4mrix2" path="res://scenes/score_ui.tscn" id="11_eb6dy"]
[ext_resource type="PackedScene" uid="uid://ocil7uree6io" path="res://scenes/background_1.tscn" id="11_ya4ey"]
[ext_resource type="PackedScene" uid="uid://dd1f74xns6x7" path="res://scenes/insects2.tscn" id="12_jbj1t"]
[ext_resource type="Script" path="res://scripts/text_bubble_manager.gd" id="15_jkv2x"]

[sub_resource type="WorldBoundaryShape2D" id="WorldBoundaryShape2D_a8y0u"]

[sub_resource type="SegmentShape2D" id="SegmentShape2D_tefeu"]
a = Vector2(-132.5899, 0)
b = Vector2(132.5899, 0)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_jbj1t"]
size = Vector2(311, 20)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_jkv2x"]
size = Vector2(45, 6)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_a8y0u"]
size = Vector2(77, 15)

[sub_resource type="GDScript" id="GDScript_a8y0u"]
script/source = "extends Node

@onready var cam = $\"../Camera2D\"
@onready var bg = preload(\"res://scenes/background_1.tscn\")

@export var platform_scene_1: PackedScene
@export var platform_scene_2: PackedScene
@export var platform_scene_3: PackedScene

@export var collectibles_1: PackedScene
@export var collectibles_2: PackedScene

@onready var playerr := $\"../Player\"
@onready var platform_sprite := [platform_scene_1, platform_scene_2, platform_scene_3]
@onready var insect_sprite := [collectibles_1, collectibles_2]

var floor_count:= 0
var floor_index := 0
var lowest_active_floor := 0

var platform_floor := [0,0,0]
var collectibles := [0,0,0]

var x_positions := [-77, 0, 77]
var y_pos := -230

const FLOOR_HEIGHT = 75
var bg1: Node
var bg2: Node
var last_bg_h = -360

func _ready() -> void:
	bg1 = bg.instantiate()
	bg2 = bg.instantiate()
	add_child(bg1)
	add_child(bg2)
	bg1.position.x = 4
	bg2.position.x = 4
	bg1.position.y = -1000 
	bg2.position.y = -1000

func spawn_floor():
	for i in range(3):
		platform_floor[i] = randi() % 4
		collectibles[i] = randi() % 3
		if platform_floor[i] > 0:
			spawn_platform(platform_floor[i] - 1, x_positions[i], y_pos)
			if collectibles[i] > 0:
				spawn_insect(collectibles[i] - 1, x_positions[i] - 5, y_pos - 10)
	if platform_floor == [0,0,0]:
		spawn_platform(1, x_positions[1], y_pos)
	floor_count += 1
	platform_floor = [0,0,0]
	y_pos -= FLOOR_HEIGHT

func spawn_platform(sprite, x_pos, y_pos):
	var platform = platform_sprite[sprite].instantiate()
	platform.position = Vector2(x_pos, y_pos)
	platform.floor_index = floor_count
	add_child(platform)

func delete_floor(index_to_delete):
	for c in get_children():
		if \"floor_index\" in c and c.floor_index == index_to_delete:
			c.queue_free()

func spawn_insect(sprite, x_pos, y_pos):
	var insect = insect_sprite[sprite].instantiate()
	insect.position = Vector2(x_pos, y_pos)
	insect.floor_index = floor_count
	add_child(insect)

func delete_insect(index_to_delete):
	for insect in get_parent().get_children():
		if \"floor_index\" in insect:
			if insect.floor_index == index_to_delete:
				insect.queue_free()

func _process(delta):
	var cam_top = cam.position.y + 100
	if playerr.position.y <= y_pos + 2*FLOOR_HEIGHT:
		spawn_floor()
		if floor_index_to_y(lowest_active_floor) > playerr.position.y + 5*FLOOR_HEIGHT:
			delete_floor(lowest_active_floor)
			lowest_active_floor += 1

	if cam_top <= last_bg_h:
		bg1.position.y = last_bg_h
		bg2.position.y = last_bg_h - 360
		last_bg_h -= 360
		
func floor_index_to_y(f_index):
	return -200 - f_index * FLOOR_HEIGHT
"

[sub_resource type="WorldBoundaryShape2D" id="WorldBoundaryShape2D_eb6dy"]
distance = -23.0

[sub_resource type="WorldBoundaryShape2D" id="WorldBoundaryShape2D_trceg"]
distance = 2.0

[node name="Node2D" type="Node2D"]
script = ExtResource("1_jbj1t")

[node name="Background2D" type="Sprite2D" parent="."]
z_index = -10
position = Vector2(3.500001, -135)
scale = Vector2(0.20377605, 0.2)
texture = ExtResource("1_jkv2x")

[node name="Player" parent="." instance=ExtResource("1_sugp2")]
scale = Vector2(0.9950222, 1)

[node name="Camera2D" parent="." instance=ExtResource("2_jyhfs")]
position = Vector2(3.875, -41)
zoom = Vector2(3.76, 3.76)
script = ExtResource("5_eb6dy")

[node name="Killzone" type="Area2D" parent="Camera2D"]
position = Vector2(-130.875, 145)
script = ExtResource("6_trceg")

[node name="Timer" type="Timer" parent="Camera2D/Killzone"]
wait_time = 0.6
one_shot = true

[node name="CollisionShape2D" type="CollisionShape2D" parent="Camera2D/Killzone"]
shape = SubResource("WorldBoundaryShape2D_a8y0u")

[node name="Placeholder" type="Node" parent="."]

[node name="PlaceholderGround5" parent="Placeholder" instance=ExtResource("3_tbgi4")]
position = Vector2(5, -150)
scale = Vector2(0.419, 0.308)

[node name="Area2D" type="Area2D" parent="Placeholder/PlaceholderGround5"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Placeholder/PlaceholderGround5/Area2D"]
position = Vector2(0, -3.2469532)
shape = SubResource("SegmentShape2D_tefeu")

[node name="ground" type="StaticBody2D" parent="Placeholder"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Placeholder/ground"]
position = Vector2(4.5, 33.5)
shape = SubResource("RectangleShape2D_jbj1t")

[node name="windowplatform" type="StaticBody2D" parent="Placeholder" groups=["window"]]
script = ExtResource("7_jbj1t")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Placeholder/windowplatform"]
position = Vector2(72.5, -15)
shape = SubResource("RectangleShape2D_jkv2x")
one_way_collision = true

[node name="windowplatform2" type="StaticBody2D" parent="Placeholder" groups=["window"]]
position = Vector2(-144, 1)
script = ExtResource("7_jbj1t")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Placeholder/windowplatform2"]
position = Vector2(73, -14)
shape = SubResource("RectangleShape2D_jkv2x")
one_way_collision = true

[node name="ground2" type="StaticBody2D" parent="Placeholder"]
position = Vector2(-1, -105)

[node name="CollisionShape2D" type="CollisionShape2D" parent="Placeholder/ground2"]
position = Vector2(4, 29)
shape = SubResource("RectangleShape2D_a8y0u")
one_way_collision = true

[node name="PlatformManager" type="Node2D" parent="."]
script = SubResource("GDScript_a8y0u")
platform_scene_1 = ExtResource("8_choun")
platform_scene_2 = ExtResource("9_a8y0u")
platform_scene_3 = ExtResource("10_jkv2x")
collectibles_1 = ExtResource("6_tefeu")
collectibles_2 = ExtResource("12_jbj1t")

[node name="CameraMoveOnTrigger" type="Marker2D" parent="."]
position = Vector2(0, -195)

[node name="Insects" parent="." instance=ExtResource("6_tefeu")]
position = Vector2(-98, -5.0000005)

[node name="Insects2" parent="." instance=ExtResource("6_tefeu")]
position = Vector2(-58.000004, -44.999996)

[node name="Insects4" parent="." instance=ExtResource("6_tefeu")]
position = Vector2(116.999985, -92.99999)

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="InsectsUI" parent="CanvasLayer" instance=ExtResource("7_o6xl0")]
scale = Vector2(0.597657, 0.597657)

[node name="score_ui" parent="CanvasLayer" instance=ExtResource("11_eb6dy")]

[node name="Sprite2D" parent="." instance=ExtResource("11_ya4ey")]
position = Vector2(4, -315)

[node name="WorldBorder" type="StaticBody2D" parent="."]

[node name="CollisionShape2D2" type="CollisionShape2D" parent="WorldBorder"]
position = Vector2(132, -43)
rotation = -1.5707964
shape = SubResource("WorldBoundaryShape2D_eb6dy")

[node name="CollisionShape2D" type="CollisionShape2D" parent="WorldBorder"]
position = Vector2(-149, -49)
rotation = 1.5707964
shape = SubResource("WorldBoundaryShape2D_trceg")

[node name="BubbleManager" type="Node2D" parent="."]
script = ExtResource("15_jkv2x")

[connection signal="body_entered" from="Camera2D/Killzone" to="Camera2D/Killzone" method="_on_body_entered"]
[connection signal="timeout" from="Camera2D/Killzone/Timer" to="Camera2D/Killzone" method="_on_timer_timeout"]
[connection signal="body_entered" from="Placeholder/PlaceholderGround5/Area2D" to="Camera2D" method="trigger_camera"]
[connection signal="body_entered" from="Placeholder/PlaceholderGround5/Area2D" to="Placeholder/PlaceholderGround5" method="_on_area_2d_body_entered"]
